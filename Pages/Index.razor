@page "/index/{pageNum:int?}"
@using MauiApp3.Common;
@using MauiApp3.Model;
@using System.Text.Encodings.Web;
@using System.Text;
@inject MauiApp3.Data.SoduService soduService;
@inject NavigationManager Navigation
@if (novelPageInfo is null)
{
    <p><em>data loadoing..........</em></p>
}
else
{

   <div>
<form>
  <div class="form-group mx-sm-3 mb-2">
    <input type="text" class="form-control" @bind="searchText" placeholder="输入小说名称">
                <button type="submit" class="btn btn-primary mb-2" @onclick=@(e=>Navigation.GoTo("/search",searchText)) @onclick:preventDefault>搜索</button>
</div>

</form>
   </div>
  <div class="d-flex flex-column bd-highlight mb-3"></div>
  <div class="p-2 bd-highlight">
      <p>当前页：@novelPageInfo.CurrentPage</p>
    <div class="btn-group container">
        <NavLink href="/" class="btn btn-lg btn-block btn-outline-primary">主页</NavLink>

            <NavLink href="/records" class="btn btn-lg btn-block btn-outline-primary">历史记录</NavLink>
        
        @if (novelPageInfo.CurrentPage > 1)
        {
                <a @onclick=@(e=>Navigation.GoTo("/index",(novelPageInfo.CurrentPage-1).ToString())) @onclick:preventDefault class="btn btn-lg btn-block btn-outline-primary">上一页</a>
        }
        @if (novelPageInfo.CurrentPage < novelPageInfo.PageCount)
        {
                <a @onclick=@(e=>Navigation.GoTo("/index",novelPageInfo.PageCount.ToString())) @onclick:preventDefault class="btn btn-lg btn-block btn-outline-primary">尾页</a>
        }
        @if (novelPageInfo.CurrentPage < novelPageInfo.PageCount)
        {
                <a @onclick=@(e=>Navigation.GoTo("/index",(novelPageInfo.CurrentPage+1).ToString())) @onclick:preventDefault class="btn btn-lg btn-block btn-outline-primary">下一页</a>
        }
    </div>
    
  </div>
  <div class="p-2 bd-highlight">
            <ul>
                @if (novelPageInfo.Infos != null)
                {
                    @foreach (var item in novelPageInfo.Infos)
                    {


                        <div class="starter-template">
                            <h1><p class="lead" @onclick=@(e=>Navigation.GoTo("/detial",item.Url,item.NovleId,item.Name,item.Url))>@item.Name</p></h1>
                            <p>@item.LastChapter</p>
                            <p>@item.UpdateTime</p>
                        </div>
                    }
                }

            </ul>
  </div>
    <div class="btn-group container">
        <NavLink href="/" class="btn btn-lg btn-block btn-outline-primary">主页</NavLink>
        
        @if (novelPageInfo.CurrentPage > 1)
        {
            <a @onclick=@(e=>Navigation.GoTo("/index",(novelPageInfo.CurrentPage-1).ToString())) @onclick:preventDefault class="btn btn-lg btn-block btn-outline-primary">上一页</a>
        }
        @if (novelPageInfo.CurrentPage < novelPageInfo.PageCount)
        {
            <a @onclick=@(e=>Navigation.GoTo("/index",novelPageInfo.PageCount.ToString())) @onclick:preventDefault class="btn btn-lg btn-block btn-outline-primary">尾页</a>
        }
        @if (novelPageInfo.CurrentPage < novelPageInfo.PageCount)
        {
            <a @onclick=@(e=>Navigation.GoTo("/index",(novelPageInfo.CurrentPage+1).ToString())) @onclick:preventDefault class="btn btn-lg btn-block btn-outline-primary">下一页</a>
        }
</div>


    
    
    
}

@code{
    [Parameter]
    public int? pageNum { get; set; }
    public string searchText {get;set;}
    private NovelPageInfo novelPageInfo;
 
    protected override async Task OnParametersSetAsync()
    {
        novelPageInfo = await soduService.GetVisit(pageNum.HasValue?pageNum.Value:1);
    }

}
